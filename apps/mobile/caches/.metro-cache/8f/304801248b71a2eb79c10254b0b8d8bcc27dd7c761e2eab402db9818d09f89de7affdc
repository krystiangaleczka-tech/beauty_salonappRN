{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":53,"index":53}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"]}},{"name":"../utils/blurhash/useBlurhash","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":172},"end":{"line":5,"column":60,"index":232}}],"key":"lRqQftRUqBHAsDz63vOx3IChX48=","exportNames":["*"]}},{"name":"../utils/resolveSources","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":233},"end":{"line":6,"column":60,"index":293}}],"key":"0tSWeLBIaokpFkEzxEQuuUkLmpc=","exportNames":["*"]}},{"name":"../utils/thumbhash/thumbhash","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":294},"end":{"line":7,"column":72,"index":366}}],"key":"t3gPHyYKdVSNbnGhfPKTKrE4uz8=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.useHeaders = useHeaders;\n  exports.useImageHashes = useImageHashes;\n  exports.useThumbhash = useThumbhash;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _useBlurhash = require(_dependencyMap[1], \"../utils/blurhash/useBlurhash\");\n  var _resolveSources = require(_dependencyMap[2], \"../utils/resolveSources\");\n  var _thumbhash = require(_dependencyMap[3], \"../utils/thumbhash/thumbhash\");\n  function useThumbhash(source) {\n    const isThumbhash = (0, _resolveSources.isThumbhashString)(source?.uri || '');\n    const strippedThumbhashString = source?.uri?.replace(/thumbhash:\\//, '') ?? '';\n    const thumbhashSource = (0, _react.useMemo)(() => isThumbhash ? {\n      uri: (0, _thumbhash.thumbHashStringToDataURL)(strippedThumbhashString)\n    } : null, [strippedThumbhashString, isThumbhash]);\n    return [thumbhashSource, isThumbhash];\n  }\n  function useImageHashes(source) {\n    const [thumbhash, isThumbhashString] = useThumbhash(source);\n    const [blurhash, isBlurhashString] = (0, _useBlurhash.useBlurhash)(source);\n    return (0, _react.useMemo)(() => {\n      if (!isThumbhashString && !isBlurhashString) {\n        return {\n          resolvedSource: source,\n          isImageHash: false\n        };\n      }\n      if (!blurhash && !thumbhash) {\n        return {\n          resolvedSource: null,\n          isImageHash: true\n        };\n      }\n      return {\n        resolvedSource: blurhash ?? thumbhash,\n        isImageHash: true\n      };\n    }, [blurhash, thumbhash, isThumbhashString, isBlurhashString, source]);\n  }\n  function useHeaders(source, cachePolicy, onError) {\n    const [objectURL, setObjectURL] = (0, _react.useState)(null);\n    (0, _react.useEffect)(() => {\n      (async () => {\n        if (!source?.headers || !source.uri) {\n          return;\n        }\n        try {\n          const result = await fetch(source.uri, {\n            headers: source.headers,\n            cache: cachePolicy === 'none' ? 'no-cache' : 'default',\n            redirect: 'follow'\n          });\n          if (!result.ok) {\n            throw new Error(`Failed to fetch image: ${result.status} ${result.statusText}`);\n          }\n          const blob = await result.blob();\n          setObjectURL(prevObjURL => {\n            if (prevObjURL) {\n              URL.revokeObjectURL(prevObjURL);\n            }\n            return URL.createObjectURL(blob);\n          });\n        } catch {\n          onError?.forEach(e => e?.({\n            source\n          }));\n        }\n      })();\n    }, [source]);\n    if (!source?.headers) {\n      return source;\n    }\n    if (!objectURL) {\n      // Avoid fetching a URL without headers if we have headers\n      return null;\n    }\n    return {\n      ...source,\n      uri: objectURL\n    };\n  }\n});","lineCount":84,"map":[[8,2,1,0],[8,6,1,0,"_react"],[8,12,1,0],[8,15,1,0,"require"],[8,22,1,0],[8,23,1,0,"_dependencyMap"],[8,37,1,0],[9,2,5,0],[9,6,5,0,"_useBlurhash"],[9,18,5,0],[9,21,5,0,"require"],[9,28,5,0],[9,29,5,0,"_dependencyMap"],[9,43,5,0],[10,2,6,0],[10,6,6,0,"_resolveSources"],[10,21,6,0],[10,24,6,0,"require"],[10,31,6,0],[10,32,6,0,"_dependencyMap"],[10,46,6,0],[11,2,7,0],[11,6,7,0,"_thumbhash"],[11,16,7,0],[11,19,7,0,"require"],[11,26,7,0],[11,27,7,0,"_dependencyMap"],[11,41,7,0],[12,2,9,7],[12,11,9,16,"useThumbhash"],[12,23,9,28,"useThumbhash"],[12,24,9,29,"source"],[12,30,9,67],[12,32,9,69],[13,4,10,2],[13,10,10,8,"isThumbhash"],[13,21,10,19],[13,24,10,22],[13,28,10,22,"isThumbhashString"],[13,61,10,39],[13,63,10,40,"source"],[13,69,10,46],[13,71,10,48,"uri"],[13,74,10,51],[13,78,10,55],[13,80,10,57],[13,81,10,58],[14,4,11,2],[14,10,11,8,"strippedThumbhashString"],[14,33,11,31],[14,36,11,34,"source"],[14,42,11,40],[14,44,11,42,"uri"],[14,47,11,45],[14,49,11,47,"replace"],[14,56,11,54],[14,57,11,55],[14,71,11,69],[14,73,11,71],[14,75,11,73],[14,76,11,74],[14,80,11,78],[14,82,11,80],[15,4,12,2],[15,10,12,8,"thumbhashSource"],[15,25,12,23],[15,28,12,26],[15,32,12,26,"useMemo"],[15,46,12,33],[15,48,13,4],[15,54,13,11,"isThumbhash"],[15,65,13,22],[15,68,13,25],[16,6,13,27,"uri"],[16,9,13,30],[16,11,13,32],[16,15,13,32,"thumbHashStringToDataURL"],[16,50,13,56],[16,52,13,57,"strippedThumbhashString"],[16,75,13,80],[17,4,13,82],[17,5,13,83],[17,8,13,86],[17,12,13,91],[17,14,14,4],[17,15,14,5,"strippedThumbhashString"],[17,38,14,28],[17,40,14,30,"isThumbhash"],[17,51,14,41],[17,52,15,2],[17,53,15,3],[18,4,16,2],[18,11,16,9],[18,12,16,10,"thumbhashSource"],[18,27,16,25],[18,29,16,27,"isThumbhash"],[18,40,16,38],[18,41,16,39],[19,2,17,0],[20,2,19,7],[20,11,19,16,"useImageHashes"],[20,25,19,30,"useImageHashes"],[20,26,19,31,"source"],[20,32,19,69],[20,34,19,71],[21,4,20,2],[21,10,20,8],[21,11,20,9,"thumbhash"],[21,20,20,18],[21,22,20,20,"isThumbhashString"],[21,39,20,37],[21,40,20,38],[21,43,20,41,"useThumbhash"],[21,55,20,53],[21,56,20,54,"source"],[21,62,20,60],[21,63,20,61],[22,4,21,2],[22,10,21,8],[22,11,21,9,"blurhash"],[22,19,21,17],[22,21,21,19,"isBlurhashString"],[22,37,21,35],[22,38,21,36],[22,41,21,39],[22,45,21,39,"useBlurhash"],[22,69,21,50],[22,71,21,51,"source"],[22,77,21,57],[22,78,21,58],[23,4,22,2],[23,11,22,9],[23,15,22,9,"useMemo"],[23,29,22,16],[23,31,22,17],[23,37,22,23],[24,6,23,4],[24,10,23,8],[24,11,23,9,"isThumbhashString"],[24,28,23,26],[24,32,23,30],[24,33,23,31,"isBlurhashString"],[24,49,23,47],[24,51,23,49],[25,8,24,6],[25,15,24,13],[26,10,24,15,"resolvedSource"],[26,24,24,29],[26,26,24,31,"source"],[26,32,24,37],[27,10,24,39,"isImageHash"],[27,21,24,50],[27,23,24,52],[28,8,24,58],[28,9,24,59],[29,6,25,4],[30,6,26,4],[30,10,26,8],[30,11,26,9,"blurhash"],[30,19,26,17],[30,23,26,21],[30,24,26,22,"thumbhash"],[30,33,26,31],[30,35,26,33],[31,8,27,6],[31,15,27,13],[32,10,27,15,"resolvedSource"],[32,24,27,29],[32,26,27,31],[32,30,27,35],[33,10,27,37,"isImageHash"],[33,21,27,48],[33,23,27,50],[34,8,27,55],[34,9,27,56],[35,6,28,4],[36,6,29,4],[36,13,29,11],[37,8,30,6,"resolvedSource"],[37,22,30,20],[37,24,30,22,"blurhash"],[37,32,30,30],[37,36,30,34,"thumbhash"],[37,45,30,43],[38,8,31,6,"isImageHash"],[38,19,31,17],[38,21,31,19],[39,6,32,4],[39,7,32,5],[40,4,33,2],[40,5,33,3],[40,7,33,5],[40,8,33,6,"blurhash"],[40,16,33,14],[40,18,33,16,"thumbhash"],[40,27,33,25],[40,29,33,27,"isThumbhashString"],[40,46,33,44],[40,48,33,46,"isBlurhashString"],[40,64,33,62],[40,66,33,64,"source"],[40,72,33,70],[40,73,33,71],[40,74,33,72],[41,2,34,0],[42,2,36,7],[42,11,36,16,"useHeaders"],[42,21,36,26,"useHeaders"],[42,22,37,2,"source"],[42,28,37,40],[42,30,38,2,"cachePolicy"],[42,41,38,46],[42,43,39,2,"onError"],[42,50,39,26],[42,52,40,34],[43,4,41,2],[43,10,41,8],[43,11,41,9,"objectURL"],[43,20,41,18],[43,22,41,20,"setObjectURL"],[43,34,41,32],[43,35,41,33],[43,38,41,36],[43,42,41,36,"useState"],[43,57,41,44],[43,59,41,60],[43,63,41,64],[43,64,41,65],[44,4,42,2],[44,8,42,2,"useEffect"],[44,24,42,11],[44,26,42,12],[44,32,42,18],[45,6,43,4],[45,7,43,5],[45,19,43,17],[46,8,44,6],[46,12,44,10],[46,13,44,11,"source"],[46,19,44,17],[46,21,44,19,"headers"],[46,28,44,26],[46,32,44,30],[46,33,44,31,"source"],[46,39,44,37],[46,40,44,38,"uri"],[46,43,44,41],[46,45,44,43],[47,10,45,8],[48,8,46,6],[49,8,47,6],[49,12,47,10],[50,10,48,8],[50,16,48,14,"result"],[50,22,48,20],[50,25,48,23],[50,31,48,29,"fetch"],[50,36,48,34],[50,37,48,35,"source"],[50,43,48,41],[50,44,48,42,"uri"],[50,47,48,45],[50,49,48,47],[51,12,49,10,"headers"],[51,19,49,17],[51,21,49,19,"source"],[51,27,49,25],[51,28,49,26,"headers"],[51,35,49,33],[52,12,50,10,"cache"],[52,17,50,15],[52,19,50,17,"cachePolicy"],[52,30,50,28],[52,35,50,33],[52,41,50,39],[52,44,50,42],[52,54,50,52],[52,57,50,55],[52,66,50,64],[53,12,51,10,"redirect"],[53,20,51,18],[53,22,51,20],[54,10,52,8],[54,11,52,9],[54,12,52,10],[55,10,53,8],[55,14,53,12],[55,15,53,13,"result"],[55,21,53,19],[55,22,53,20,"ok"],[55,24,53,22],[55,26,53,24],[56,12,54,10],[56,18,54,16],[56,22,54,20,"Error"],[56,27,54,25],[56,28,54,26],[56,54,54,52,"result"],[56,60,54,58],[56,61,54,59,"status"],[56,67,54,65],[56,71,54,69,"result"],[56,77,54,75],[56,78,54,76,"statusText"],[56,88,54,86],[56,90,54,88],[56,91,54,89],[57,10,55,8],[58,10,56,8],[58,16,56,14,"blob"],[58,20,56,18],[58,23,56,21],[58,29,56,27,"result"],[58,35,56,33],[58,36,56,34,"blob"],[58,40,56,38],[58,41,56,39],[58,42,56,40],[59,10,57,8,"setObjectURL"],[59,22,57,20],[59,23,57,22,"prevObjURL"],[59,33,57,32],[59,37,57,37],[60,12,58,10],[60,16,58,14,"prevObjURL"],[60,26,58,24],[60,28,58,26],[61,14,59,12,"URL"],[61,17,59,15],[61,18,59,16,"revokeObjectURL"],[61,33,59,31],[61,34,59,32,"prevObjURL"],[61,44,59,42],[61,45,59,43],[62,12,60,10],[63,12,61,10],[63,19,61,17,"URL"],[63,22,61,20],[63,23,61,21,"createObjectURL"],[63,38,61,36],[63,39,61,37,"blob"],[63,43,61,41],[63,44,61,42],[64,10,62,8],[64,11,62,9],[64,12,62,10],[65,8,63,6],[65,9,63,7],[65,10,63,8],[65,16,63,14],[66,10,64,8,"onError"],[66,17,64,15],[66,19,64,17,"forEach"],[66,26,64,24],[66,27,64,26,"e"],[66,28,64,27],[66,32,64,32,"e"],[66,33,64,33],[66,36,64,36],[67,12,64,38,"source"],[68,10,64,45],[68,11,64,46],[68,12,64,47],[68,13,64,48],[69,8,65,6],[70,6,66,4],[70,7,66,5],[70,9,66,7],[70,10,66,8],[71,4,67,2],[71,5,67,3],[71,7,67,5],[71,8,67,6,"source"],[71,14,67,12],[71,15,67,13],[71,16,67,14],[72,4,68,2],[72,8,68,6],[72,9,68,7,"source"],[72,15,68,13],[72,17,68,15,"headers"],[72,24,68,22],[72,26,68,24],[73,6,69,4],[73,13,69,11,"source"],[73,19,69,17],[74,4,70,2],[75,4,71,2],[75,8,71,6],[75,9,71,7,"objectURL"],[75,18,71,16],[75,20,71,18],[76,6,72,4],[77,6,73,4],[77,13,73,11],[77,17,73,15],[78,4,74,2],[79,4,75,2],[79,11,75,9],[80,6,75,11],[80,9,75,14,"source"],[80,15,75,20],[81,6,75,22,"uri"],[81,9,75,25],[81,11,75,27,"objectURL"],[82,4,75,37],[82,5,75,38],[83,2,76,0],[84,0,76,1],[84,3]],"functionMap":{"names":["<global>","useThumbhash","useMemo$argument_0","useImageHashes","useHeaders","useEffect$argument_0","<anonymous>","setObjectURL$argument_0","onError.forEach$argument_0"],"mappings":"AAA;OCQ;ICI,uFD;CDI;OGE;iBDG;GCW;CHC;OIE;YCM;KCC;qBCc;SDK;yBEE,sBF;KDE;GDC;CJS"}},"type":"js/module"}]}