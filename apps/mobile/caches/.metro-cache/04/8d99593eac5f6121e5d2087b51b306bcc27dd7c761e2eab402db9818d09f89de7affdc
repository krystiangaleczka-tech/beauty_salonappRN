{"dependencies":[{"name":"react","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":53,"index":53}}],"key":"RtGiGa+/H7VrI7GDQDLhO1UbpU8=","exportNames":["*"],"imports":1}},{"name":"../utils/blurhash/useBlurhash","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":172},"end":{"line":5,"column":60,"index":232}}],"key":"lRqQftRUqBHAsDz63vOx3IChX48=","exportNames":["*"],"imports":1}},{"name":"../utils/resolveSources","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":233},"end":{"line":6,"column":60,"index":293}}],"key":"0tSWeLBIaokpFkEzxEQuuUkLmpc=","exportNames":["*"],"imports":1}},{"name":"../utils/thumbhash/thumbhash","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":7,"column":0,"index":294},"end":{"line":7,"column":72,"index":366}}],"key":"t3gPHyYKdVSNbnGhfPKTKrE4uz8=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.useThumbhash = useThumbhash;\n  exports.useImageHashes = useImageHashes;\n  exports.useHeaders = useHeaders;\n  var _react = require(_dependencyMap[0], \"react\");\n  var _utilsBlurhashUseBlurhash = require(_dependencyMap[1], \"../utils/blurhash/useBlurhash\");\n  var _utilsResolveSources = require(_dependencyMap[2], \"../utils/resolveSources\");\n  var _utilsThumbhashThumbhash = require(_dependencyMap[3], \"../utils/thumbhash/thumbhash\");\n  function useThumbhash(source) {\n    const isThumbhash = (0, _utilsResolveSources.isThumbhashString)(source?.uri || '');\n    const strippedThumbhashString = source?.uri?.replace(/thumbhash:\\//, '') ?? '';\n    const thumbhashSource = (0, _react.useMemo)(() => isThumbhash ? {\n      uri: (0, _utilsThumbhashThumbhash.thumbHashStringToDataURL)(strippedThumbhashString)\n    } : null, [strippedThumbhashString, isThumbhash]);\n    return [thumbhashSource, isThumbhash];\n  }\n  function useImageHashes(source) {\n    const [thumbhash, isThumbhashString] = useThumbhash(source);\n    const [blurhash, isBlurhashString] = (0, _utilsBlurhashUseBlurhash.useBlurhash)(source);\n    return (0, _react.useMemo)(() => {\n      if (!isThumbhashString && !isBlurhashString) {\n        return {\n          resolvedSource: source,\n          isImageHash: false\n        };\n      }\n      if (!blurhash && !thumbhash) {\n        return {\n          resolvedSource: null,\n          isImageHash: true\n        };\n      }\n      return {\n        resolvedSource: blurhash ?? thumbhash,\n        isImageHash: true\n      };\n    }, [blurhash, thumbhash, isThumbhashString, isBlurhashString, source]);\n  }\n  function useHeaders(source, cachePolicy, onError) {\n    const [objectURL, setObjectURL] = (0, _react.useState)(null);\n    (0, _react.useEffect)(() => {\n      (async () => {\n        if (!source?.headers || !source.uri) {\n          return;\n        }\n        try {\n          const result = await fetch(source.uri, {\n            headers: source.headers,\n            cache: cachePolicy === 'none' ? 'no-cache' : 'default',\n            redirect: 'follow'\n          });\n          if (!result.ok) {\n            throw new Error(`Failed to fetch image: ${result.status} ${result.statusText}`);\n          }\n          const blob = await result.blob();\n          setObjectURL(prevObjURL => {\n            if (prevObjURL) {\n              URL.revokeObjectURL(prevObjURL);\n            }\n            return URL.createObjectURL(blob);\n          });\n        } catch {\n          onError?.forEach(e => e?.({\n            source\n          }));\n        }\n      })();\n    }, [source]);\n    if (!source?.headers) {\n      return source;\n    }\n    if (!objectURL) {\n      // Avoid fetching a URL without headers if we have headers\n      return null;\n    }\n    return {\n      ...source,\n      uri: objectURL\n    };\n  }\n});","lineCount":86,"map":[[7,2,9,0,"exports"],[7,9,9,0],[7,10,9,0,"useThumbhash"],[7,22,9,0],[7,25,9,0,"useThumbhash"],[7,37,9,0],[8,2,19,0,"exports"],[8,9,19,0],[8,10,19,0,"useImageHashes"],[8,24,19,0],[8,27,19,0,"useImageHashes"],[8,41,19,0],[9,2,36,0,"exports"],[9,9,36,0],[9,10,36,0,"useHeaders"],[9,20,36,0],[9,23,36,0,"useHeaders"],[9,33,36,0],[10,2,1,0],[10,6,1,0,"_react"],[10,12,1,0],[10,15,1,0,"require"],[10,22,1,0],[10,23,1,0,"_dependencyMap"],[10,37,1,0],[11,2,5,0],[11,6,5,0,"_utilsBlurhashUseBlurhash"],[11,31,5,0],[11,34,5,0,"require"],[11,41,5,0],[11,42,5,0,"_dependencyMap"],[11,56,5,0],[12,2,6,0],[12,6,6,0,"_utilsResolveSources"],[12,26,6,0],[12,29,6,0,"require"],[12,36,6,0],[12,37,6,0,"_dependencyMap"],[12,51,6,0],[13,2,7,0],[13,6,7,0,"_utilsThumbhashThumbhash"],[13,30,7,0],[13,33,7,0,"require"],[13,40,7,0],[13,41,7,0,"_dependencyMap"],[13,55,7,0],[14,2,9,7],[14,11,9,16,"useThumbhash"],[14,23,9,28,"useThumbhash"],[14,24,9,29,"source"],[14,30,9,67],[14,32,9,69],[15,4,10,2],[15,10,10,8,"isThumbhash"],[15,21,10,19],[15,24,10,22],[15,28,10,22,"isThumbhashString"],[15,48,10,39],[15,49,10,39,"isThumbhashString"],[15,66,10,39],[15,68,10,40,"source"],[15,74,10,46],[15,76,10,48,"uri"],[15,79,10,51],[15,83,10,55],[15,85,10,57],[15,86,10,58],[16,4,11,2],[16,10,11,8,"strippedThumbhashString"],[16,33,11,31],[16,36,11,34,"source"],[16,42,11,40],[16,44,11,42,"uri"],[16,47,11,45],[16,49,11,47,"replace"],[16,56,11,54],[16,57,11,55],[16,71,11,69],[16,73,11,71],[16,75,11,73],[16,76,11,74],[16,80,11,78],[16,82,11,80],[17,4,12,2],[17,10,12,8,"thumbhashSource"],[17,25,12,23],[17,28,12,26],[17,32,12,26,"useMemo"],[17,38,12,33],[17,39,12,33,"useMemo"],[17,46,12,33],[17,48,13,4],[17,54,13,11,"isThumbhash"],[17,65,13,22],[17,68,13,25],[18,6,13,27,"uri"],[18,9,13,30],[18,11,13,32],[18,15,13,32,"thumbHashStringToDataURL"],[18,39,13,56],[18,40,13,56,"thumbHashStringToDataURL"],[18,64,13,56],[18,66,13,57,"strippedThumbhashString"],[18,89,13,80],[19,4,13,82],[19,5,13,83],[19,8,13,86],[19,12,13,91],[19,14,14,4],[19,15,14,5,"strippedThumbhashString"],[19,38,14,28],[19,40,14,30,"isThumbhash"],[19,51,14,41],[19,52,15,2],[19,53,15,3],[20,4,16,2],[20,11,16,9],[20,12,16,10,"thumbhashSource"],[20,27,16,25],[20,29,16,27,"isThumbhash"],[20,40,16,38],[20,41,16,39],[21,2,17,0],[22,2,19,7],[22,11,19,16,"useImageHashes"],[22,25,19,30,"useImageHashes"],[22,26,19,31,"source"],[22,32,19,69],[22,34,19,71],[23,4,20,2],[23,10,20,8],[23,11,20,9,"thumbhash"],[23,20,20,18],[23,22,20,20,"isThumbhashString"],[23,39,20,37],[23,40,20,38],[23,43,20,41,"useThumbhash"],[23,55,20,53],[23,56,20,54,"source"],[23,62,20,60],[23,63,20,61],[24,4,21,2],[24,10,21,8],[24,11,21,9,"blurhash"],[24,19,21,17],[24,21,21,19,"isBlurhashString"],[24,37,21,35],[24,38,21,36],[24,41,21,39],[24,45,21,39,"useBlurhash"],[24,70,21,50],[24,71,21,50,"useBlurhash"],[24,82,21,50],[24,84,21,51,"source"],[24,90,21,57],[24,91,21,58],[25,4,22,2],[25,11,22,9],[25,15,22,9,"useMemo"],[25,21,22,16],[25,22,22,16,"useMemo"],[25,29,22,16],[25,31,22,17],[25,37,22,23],[26,6,23,4],[26,10,23,8],[26,11,23,9,"isThumbhashString"],[26,28,23,26],[26,32,23,30],[26,33,23,31,"isBlurhashString"],[26,49,23,47],[26,51,23,49],[27,8,24,6],[27,15,24,13],[28,10,24,15,"resolvedSource"],[28,24,24,29],[28,26,24,31,"source"],[28,32,24,37],[29,10,24,39,"isImageHash"],[29,21,24,50],[29,23,24,52],[30,8,24,58],[30,9,24,59],[31,6,25,4],[32,6,26,4],[32,10,26,8],[32,11,26,9,"blurhash"],[32,19,26,17],[32,23,26,21],[32,24,26,22,"thumbhash"],[32,33,26,31],[32,35,26,33],[33,8,27,6],[33,15,27,13],[34,10,27,15,"resolvedSource"],[34,24,27,29],[34,26,27,31],[34,30,27,35],[35,10,27,37,"isImageHash"],[35,21,27,48],[35,23,27,50],[36,8,27,55],[36,9,27,56],[37,6,28,4],[38,6,29,4],[38,13,29,11],[39,8,30,6,"resolvedSource"],[39,22,30,20],[39,24,30,22,"blurhash"],[39,32,30,30],[39,36,30,34,"thumbhash"],[39,45,30,43],[40,8,31,6,"isImageHash"],[40,19,31,17],[40,21,31,19],[41,6,32,4],[41,7,32,5],[42,4,33,2],[42,5,33,3],[42,7,33,5],[42,8,33,6,"blurhash"],[42,16,33,14],[42,18,33,16,"thumbhash"],[42,27,33,25],[42,29,33,27,"isThumbhashString"],[42,46,33,44],[42,48,33,46,"isBlurhashString"],[42,64,33,62],[42,66,33,64,"source"],[42,72,33,70],[42,73,33,71],[42,74,33,72],[43,2,34,0],[44,2,36,7],[44,11,36,16,"useHeaders"],[44,21,36,26,"useHeaders"],[44,22,37,2,"source"],[44,28,37,40],[44,30,38,2,"cachePolicy"],[44,41,38,46],[44,43,39,2,"onError"],[44,50,39,26],[44,52,40,34],[45,4,41,2],[45,10,41,8],[45,11,41,9,"objectURL"],[45,20,41,18],[45,22,41,20,"setObjectURL"],[45,34,41,32],[45,35,41,33],[45,38,41,36],[45,42,41,36,"useState"],[45,48,41,44],[45,49,41,44,"useState"],[45,57,41,44],[45,59,41,60],[45,63,41,64],[45,64,41,65],[46,4,42,2],[46,8,42,2,"useEffect"],[46,14,42,11],[46,15,42,11,"useEffect"],[46,24,42,11],[46,26,42,12],[46,32,42,18],[47,6,43,4],[47,7,43,5],[47,19,43,17],[48,8,44,6],[48,12,44,10],[48,13,44,11,"source"],[48,19,44,17],[48,21,44,19,"headers"],[48,28,44,26],[48,32,44,30],[48,33,44,31,"source"],[48,39,44,37],[48,40,44,38,"uri"],[48,43,44,41],[48,45,44,43],[49,10,45,8],[50,8,46,6],[51,8,47,6],[51,12,47,10],[52,10,48,8],[52,16,48,14,"result"],[52,22,48,20],[52,25,48,23],[52,31,48,29,"fetch"],[52,36,48,34],[52,37,48,35,"source"],[52,43,48,41],[52,44,48,42,"uri"],[52,47,48,45],[52,49,48,47],[53,12,49,10,"headers"],[53,19,49,17],[53,21,49,19,"source"],[53,27,49,25],[53,28,49,26,"headers"],[53,35,49,33],[54,12,50,10,"cache"],[54,17,50,15],[54,19,50,17,"cachePolicy"],[54,30,50,28],[54,35,50,33],[54,41,50,39],[54,44,50,42],[54,54,50,52],[54,57,50,55],[54,66,50,64],[55,12,51,10,"redirect"],[55,20,51,18],[55,22,51,20],[56,10,52,8],[56,11,52,9],[56,12,52,10],[57,10,53,8],[57,14,53,12],[57,15,53,13,"result"],[57,21,53,19],[57,22,53,20,"ok"],[57,24,53,22],[57,26,53,24],[58,12,54,10],[58,18,54,16],[58,22,54,20,"Error"],[58,27,54,25],[58,28,54,26],[58,54,54,52,"result"],[58,60,54,58],[58,61,54,59,"status"],[58,67,54,65],[58,71,54,69,"result"],[58,77,54,75],[58,78,54,76,"statusText"],[58,88,54,86],[58,90,54,88],[58,91,54,89],[59,10,55,8],[60,10,56,8],[60,16,56,14,"blob"],[60,20,56,18],[60,23,56,21],[60,29,56,27,"result"],[60,35,56,33],[60,36,56,34,"blob"],[60,40,56,38],[60,41,56,39],[60,42,56,40],[61,10,57,8,"setObjectURL"],[61,22,57,20],[61,23,57,22,"prevObjURL"],[61,33,57,32],[61,37,57,37],[62,12,58,10],[62,16,58,14,"prevObjURL"],[62,26,58,24],[62,28,58,26],[63,14,59,12,"URL"],[63,17,59,15],[63,18,59,16,"revokeObjectURL"],[63,33,59,31],[63,34,59,32,"prevObjURL"],[63,44,59,42],[63,45,59,43],[64,12,60,10],[65,12,61,10],[65,19,61,17,"URL"],[65,22,61,20],[65,23,61,21,"createObjectURL"],[65,38,61,36],[65,39,61,37,"blob"],[65,43,61,41],[65,44,61,42],[66,10,62,8],[66,11,62,9],[66,12,62,10],[67,8,63,6],[67,9,63,7],[67,10,63,8],[67,16,63,14],[68,10,64,8,"onError"],[68,17,64,15],[68,19,64,17,"forEach"],[68,26,64,24],[68,27,64,26,"e"],[68,28,64,27],[68,32,64,32,"e"],[68,33,64,33],[68,36,64,36],[69,12,64,38,"source"],[70,10,64,45],[70,11,64,46],[70,12,64,47],[70,13,64,48],[71,8,65,6],[72,6,66,4],[72,7,66,5],[72,9,66,7],[72,10,66,8],[73,4,67,2],[73,5,67,3],[73,7,67,5],[73,8,67,6,"source"],[73,14,67,12],[73,15,67,13],[73,16,67,14],[74,4,68,2],[74,8,68,6],[74,9,68,7,"source"],[74,15,68,13],[74,17,68,15,"headers"],[74,24,68,22],[74,26,68,24],[75,6,69,4],[75,13,69,11,"source"],[75,19,69,17],[76,4,70,2],[77,4,71,2],[77,8,71,6],[77,9,71,7,"objectURL"],[77,18,71,16],[77,20,71,18],[78,6,72,4],[79,6,73,4],[79,13,73,11],[79,17,73,15],[80,4,74,2],[81,4,75,2],[81,11,75,9],[82,6,75,11],[82,9,75,14,"source"],[82,15,75,20],[83,6,75,22,"uri"],[83,9,75,25],[83,11,75,27,"objectURL"],[84,4,75,37],[84,5,75,38],[85,2,76,0],[86,0,76,1],[86,3]],"functionMap":{"names":["<global>","useThumbhash","useMemo$argument_0","useImageHashes","useHeaders","useEffect$argument_0","<anonymous>","setObjectURL$argument_0","onError.forEach$argument_0"],"mappings":"AAA;OCQ;ICI,uFD;CDI;OGE;iBDG;GCW;CHC;OIE;YCM;KCC;qBCc;SDK;yBEE,sBF;KDE;GDC;CJS"},"hasCjsExports":false},"type":"js/module"}]}