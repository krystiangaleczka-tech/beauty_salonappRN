{"dependencies":[{"name":"./on-next-frame.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":67,"index":67}}],"key":"6FI1rezAbomF7E9+jncvacSaiQo=","exportNames":["*"],"imports":1}},{"name":"./create-render-step.mjs","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":68},"end":{"line":2,"column":60,"index":128}}],"key":"UaCUZ/fKCOq61vl4rOEnIopX2nk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  Object.defineProperty(exports, \"cancelSync\", {\n    enumerable: true,\n    get: function () {\n      return cancelSync;\n    }\n  });\n  Object.defineProperty(exports, \"flushSync\", {\n    enumerable: true,\n    get: function () {\n      return flushSync;\n    }\n  });\n  Object.defineProperty(exports, \"getFrameData\", {\n    enumerable: true,\n    get: function () {\n      return getFrameData;\n    }\n  });\n  var _onNextFrameMjs = require(_dependencyMap[0], \"./on-next-frame.mjs\");\n  var _createRenderStepMjs = require(_dependencyMap[1], \"./create-render-step.mjs\");\n  const maxElapsed = 40;\n  let useDefaultElapsed = true;\n  let runNextFrame = false;\n  let isProcessing = false;\n  const frame = {\n    delta: 0,\n    timestamp: 0\n  };\n  const stepsOrder = [\"read\", \"update\", \"preRender\", \"render\", \"postRender\"];\n  const steps = stepsOrder.reduce((acc, key) => {\n    acc[key] = (0, _createRenderStepMjs.createRenderStep)(() => runNextFrame = true);\n    return acc;\n  }, {});\n  const sync = stepsOrder.reduce((acc, key) => {\n    const step = steps[key];\n    acc[key] = (process, keepAlive = false, immediate = false) => {\n      if (!runNextFrame) startLoop();\n      return step.schedule(process, keepAlive, immediate);\n    };\n    return acc;\n  }, {});\n  const cancelSync = stepsOrder.reduce((acc, key) => {\n    acc[key] = steps[key].cancel;\n    return acc;\n  }, {});\n  const flushSync = stepsOrder.reduce((acc, key) => {\n    acc[key] = () => steps[key].process(frame);\n    return acc;\n  }, {});\n  const processStep = stepId => steps[stepId].process(frame);\n  const processFrame = timestamp => {\n    runNextFrame = false;\n    frame.delta = useDefaultElapsed ? _onNextFrameMjs.defaultTimestep : Math.max(Math.min(timestamp - frame.timestamp, maxElapsed), 1);\n    frame.timestamp = timestamp;\n    isProcessing = true;\n    stepsOrder.forEach(processStep);\n    isProcessing = false;\n    if (runNextFrame) {\n      useDefaultElapsed = false;\n      (0, _onNextFrameMjs.onNextFrame)(processFrame);\n    }\n  };\n  const startLoop = () => {\n    runNextFrame = true;\n    useDefaultElapsed = true;\n    if (!isProcessing) (0, _onNextFrameMjs.onNextFrame)(processFrame);\n  };\n  const getFrameData = () => frame;\n  var _default = sync;\n});","lineCount":82,"map":[[7,2,63,0,"Object"],[7,8,63,0],[7,9,63,0,"defineProperty"],[7,23,63,0],[7,24,63,0,"exports"],[7,31,63,0],[8,4,63,0,"enumerable"],[8,14,63,0],[9,4,63,0,"get"],[9,7,63,0],[9,18,63,0,"get"],[9,19,63,0],[10,6,63,0],[10,13,63,0,"_default"],[10,21,63,0],[11,4,63,0],[12,2,63,0],[13,2,64,0,"Object"],[13,8,64,0],[13,9,64,0,"defineProperty"],[13,23,64,0],[13,24,64,0,"exports"],[13,31,64,0],[14,4,64,0,"enumerable"],[14,14,64,0],[15,4,64,0,"get"],[15,7,64,0],[15,18,64,0,"get"],[15,19,64,0],[16,6,64,0],[16,13,64,9,"cancelSync"],[16,23,64,19],[17,4,64,19],[18,2,64,19],[19,2,64,0,"Object"],[19,8,64,0],[19,9,64,0,"defineProperty"],[19,23,64,0],[19,24,64,0,"exports"],[19,31,64,0],[20,4,64,0,"enumerable"],[20,14,64,0],[21,4,64,0,"get"],[21,7,64,0],[21,18,64,0,"get"],[21,19,64,0],[22,6,64,0],[22,13,64,21,"flushSync"],[22,22,64,30],[23,4,64,30],[24,2,64,30],[25,2,64,0,"Object"],[25,8,64,0],[25,9,64,0,"defineProperty"],[25,23,64,0],[25,24,64,0,"exports"],[25,31,64,0],[26,4,64,0,"enumerable"],[26,14,64,0],[27,4,64,0,"get"],[27,7,64,0],[27,18,64,0,"get"],[27,19,64,0],[28,6,64,0],[28,13,64,32,"getFrameData"],[28,25,64,44],[29,4,64,44],[30,2,64,44],[31,2,1,0],[31,6,1,0,"_onNextFrameMjs"],[31,21,1,0],[31,24,1,0,"require"],[31,31,1,0],[31,32,1,0,"_dependencyMap"],[31,46,1,0],[32,2,2,0],[32,6,2,0,"_createRenderStepMjs"],[32,26,2,0],[32,29,2,0,"require"],[32,36,2,0],[32,37,2,0,"_dependencyMap"],[32,51,2,0],[33,2,4,0],[33,8,4,6,"maxElapsed"],[33,18,4,16],[33,21,4,19],[33,23,4,21],[34,2,5,0],[34,6,5,4,"useDefaultElapsed"],[34,23,5,21],[34,26,5,24],[34,30,5,28],[35,2,6,0],[35,6,6,4,"runNextFrame"],[35,18,6,16],[35,21,6,19],[35,26,6,24],[36,2,7,0],[36,6,7,4,"isProcessing"],[36,18,7,16],[36,21,7,19],[36,26,7,24],[37,2,8,0],[37,8,8,6,"frame"],[37,13,8,11],[37,16,8,14],[38,4,9,4,"delta"],[38,9,9,9],[38,11,9,11],[38,12,9,12],[39,4,10,4,"timestamp"],[39,13,10,13],[39,15,10,15],[40,2,11,0],[40,3,11,1],[41,2,12,0],[41,8,12,6,"stepsOrder"],[41,18,12,16],[41,21,12,19],[41,22,13,4],[41,28,13,10],[41,30,14,4],[41,38,14,12],[41,40,15,4],[41,51,15,15],[41,53,16,4],[41,61,16,12],[41,63,17,4],[41,75,17,16],[41,76,18,1],[42,2,19,0],[42,8,19,6,"steps"],[42,13,19,11],[42,16,19,14,"stepsOrder"],[42,26,19,24],[42,27,19,25,"reduce"],[42,33,19,31],[42,34,19,32],[42,35,19,33,"acc"],[42,38,19,36],[42,40,19,38,"key"],[42,43,19,41],[42,48,19,46],[43,4,20,4,"acc"],[43,7,20,7],[43,8,20,8,"key"],[43,11,20,11],[43,12,20,12],[43,15,20,15],[43,19,20,15,"createRenderStep"],[43,39,20,31],[43,40,20,31,"createRenderStep"],[43,56,20,31],[43,58,20,32],[43,64,20,39,"runNextFrame"],[43,76,20,51],[43,79,20,54],[43,83,20,59],[43,84,20,60],[44,4,21,4],[44,11,21,11,"acc"],[44,14,21,14],[45,2,22,0],[45,3,22,1],[45,5,22,3],[45,6,22,4],[45,7,22,5],[45,8,22,6],[46,2,23,0],[46,8,23,6,"sync"],[46,12,23,10],[46,15,23,13,"stepsOrder"],[46,25,23,23],[46,26,23,24,"reduce"],[46,32,23,30],[46,33,23,31],[46,34,23,32,"acc"],[46,37,23,35],[46,39,23,37,"key"],[46,42,23,40],[46,47,23,45],[47,4,24,4],[47,10,24,10,"step"],[47,14,24,14],[47,17,24,17,"steps"],[47,22,24,22],[47,23,24,23,"key"],[47,26,24,26],[47,27,24,27],[48,4,25,4,"acc"],[48,7,25,7],[48,8,25,8,"key"],[48,11,25,11],[48,12,25,12],[48,15,25,15],[48,16,25,16,"process"],[48,23,25,23],[48,25,25,25,"keepAlive"],[48,34,25,34],[48,37,25,37],[48,42,25,42],[48,44,25,44,"immediate"],[48,53,25,53],[48,56,25,56],[48,61,25,61],[48,66,25,66],[49,6,26,8],[49,10,26,12],[49,11,26,13,"runNextFrame"],[49,23,26,25],[49,25,27,12,"startLoop"],[49,34,27,21],[49,35,27,22],[49,36,27,23],[50,6,28,8],[50,13,28,15,"step"],[50,17,28,19],[50,18,28,20,"schedule"],[50,26,28,28],[50,27,28,29,"process"],[50,34,28,36],[50,36,28,38,"keepAlive"],[50,45,28,47],[50,47,28,49,"immediate"],[50,56,28,58],[50,57,28,59],[51,4,29,4],[51,5,29,5],[52,4,30,4],[52,11,30,11,"acc"],[52,14,30,14],[53,2,31,0],[53,3,31,1],[53,5,31,3],[53,6,31,4],[53,7,31,5],[53,8,31,6],[54,2,32,0],[54,8,32,6,"cancelSync"],[54,18,32,16],[54,21,32,19,"stepsOrder"],[54,31,32,29],[54,32,32,30,"reduce"],[54,38,32,36],[54,39,32,37],[54,40,32,38,"acc"],[54,43,32,41],[54,45,32,43,"key"],[54,48,32,46],[54,53,32,51],[55,4,33,4,"acc"],[55,7,33,7],[55,8,33,8,"key"],[55,11,33,11],[55,12,33,12],[55,15,33,15,"steps"],[55,20,33,20],[55,21,33,21,"key"],[55,24,33,24],[55,25,33,25],[55,26,33,26,"cancel"],[55,32,33,32],[56,4,34,4],[56,11,34,11,"acc"],[56,14,34,14],[57,2,35,0],[57,3,35,1],[57,5,35,3],[57,6,35,4],[57,7,35,5],[57,8,35,6],[58,2,36,0],[58,8,36,6,"flushSync"],[58,17,36,15],[58,20,36,18,"stepsOrder"],[58,30,36,28],[58,31,36,29,"reduce"],[58,37,36,35],[58,38,36,36],[58,39,36,37,"acc"],[58,42,36,40],[58,44,36,42,"key"],[58,47,36,45],[58,52,36,50],[59,4,37,4,"acc"],[59,7,37,7],[59,8,37,8,"key"],[59,11,37,11],[59,12,37,12],[59,15,37,15],[59,21,37,21,"steps"],[59,26,37,26],[59,27,37,27,"key"],[59,30,37,30],[59,31,37,31],[59,32,37,32,"process"],[59,39,37,39],[59,40,37,40,"frame"],[59,45,37,45],[59,46,37,46],[60,4,38,4],[60,11,38,11,"acc"],[60,14,38,14],[61,2,39,0],[61,3,39,1],[61,5,39,3],[61,6,39,4],[61,7,39,5],[61,8,39,6],[62,2,40,0],[62,8,40,6,"processStep"],[62,19,40,17],[62,22,40,21,"stepId"],[62,28,40,27],[62,32,40,32,"steps"],[62,37,40,37],[62,38,40,38,"stepId"],[62,44,40,44],[62,45,40,45],[62,46,40,46,"process"],[62,53,40,53],[62,54,40,54,"frame"],[62,59,40,59],[62,60,40,60],[63,2,41,0],[63,8,41,6,"processFrame"],[63,20,41,18],[63,23,41,22,"timestamp"],[63,32,41,31],[63,36,41,36],[64,4,42,4,"runNextFrame"],[64,16,42,16],[64,19,42,19],[64,24,42,24],[65,4,43,4,"frame"],[65,9,43,9],[65,10,43,10,"delta"],[65,15,43,15],[65,18,43,18,"useDefaultElapsed"],[65,35,43,35],[65,38,44,10,"defaultTimestep"],[65,53,44,25],[65,54,44,25,"defaultTimestep"],[65,69,44,25],[65,72,45,10,"Math"],[65,76,45,14],[65,77,45,15,"max"],[65,80,45,18],[65,81,45,19,"Math"],[65,85,45,23],[65,86,45,24,"min"],[65,89,45,27],[65,90,45,28,"timestamp"],[65,99,45,37],[65,102,45,40,"frame"],[65,107,45,45],[65,108,45,46,"timestamp"],[65,117,45,55],[65,119,45,57,"maxElapsed"],[65,129,45,67],[65,130,45,68],[65,132,45,70],[65,133,45,71],[65,134,45,72],[66,4,46,4,"frame"],[66,9,46,9],[66,10,46,10,"timestamp"],[66,19,46,19],[66,22,46,22,"timestamp"],[66,31,46,31],[67,4,47,4,"isProcessing"],[67,16,47,16],[67,19,47,19],[67,23,47,23],[68,4,48,4,"stepsOrder"],[68,14,48,14],[68,15,48,15,"forEach"],[68,22,48,22],[68,23,48,23,"processStep"],[68,34,48,34],[68,35,48,35],[69,4,49,4,"isProcessing"],[69,16,49,16],[69,19,49,19],[69,24,49,24],[70,4,50,4],[70,8,50,8,"runNextFrame"],[70,20,50,20],[70,22,50,22],[71,6,51,8,"useDefaultElapsed"],[71,23,51,25],[71,26,51,28],[71,31,51,33],[72,6,52,8],[72,10,52,8,"onNextFrame"],[72,25,52,19],[72,26,52,19,"onNextFrame"],[72,37,52,19],[72,39,52,20,"processFrame"],[72,51,52,32],[72,52,52,33],[73,4,53,4],[74,2,54,0],[74,3,54,1],[75,2,55,0],[75,8,55,6,"startLoop"],[75,17,55,15],[75,20,55,18,"startLoop"],[75,21,55,18],[75,26,55,24],[76,4,56,4,"runNextFrame"],[76,16,56,16],[76,19,56,19],[76,23,56,23],[77,4,57,4,"useDefaultElapsed"],[77,21,57,21],[77,24,57,24],[77,28,57,28],[78,4,58,4],[78,8,58,8],[78,9,58,9,"isProcessing"],[78,21,58,21],[78,23,59,8],[78,27,59,8,"onNextFrame"],[78,42,59,19],[78,43,59,19,"onNextFrame"],[78,54,59,19],[78,56,59,20,"processFrame"],[78,68,59,32],[78,69,59,33],[79,2,60,0],[79,3,60,1],[80,2,61,0],[80,8,61,6,"getFrameData"],[80,20,61,18],[80,23,61,21,"getFrameData"],[80,24,61,21],[80,29,61,27,"frame"],[80,34,61,32],[81,2,63,0],[81,6,63,0,"_default"],[81,14,63,0],[81,17,63,15,"sync"],[81,21,63,19],[82,0,63,20],[82,3]],"functionMap":{"names":["<global>","stepsOrder.reduce$argument_0","createRenderStep$argument_0","acc.key","processStep","processFrame","startLoop","getFrameData"],"mappings":"AAA;gCCkB;gCCC,2BD;CDE;+BCC;eEE;KFI;CDE;qCCC;CDG;oCCC;eEC,+BF;CDE;oBIC,wCJ;qBKC;CLa;kBMC;CNK;qBOC,WP"},"hasCjsExports":false},"type":"js/module"}]}